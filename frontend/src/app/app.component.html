<main class="container">
  <header class="header">
    <h1 class="title">Todo tracker üìã&nbsp;‚úÖ</h1>
  </header>

  <!-- Add Task Section -->
  <section class="section">
    <form
      (ngSubmit)="addTask()"
      class="form"
      role="form"
      aria-label="Add new task"
    >
      <label for="new-task-input" class="sr-only">Task title</label>
      <input
        id="new-task-input"
        type="text"
        [(ngModel)]="newTodoTitle"
        name="newTodoTitle"
        placeholder="What needs to be done?"
        class="input"
        aria-describedby="add-task-button"
      />
      <button
        id="add-task-button"
        type="submit"
        class="addButton"
        aria-label="Add new task"
      >
        Add todo
      </button>
    </form>
  </section>

  <!-- Loading State -->
  <section *ngIf="isLoading" class="section">
    <div class="loadingSpinner"></div>
  </section>

  <!-- Error State -->
  <section *ngIf="fetchError" class="section">
    <div class="errorContainer">
      <h3 class="errorTitle">Connection Error</h3>
      <p class="errorText">{{ fetchError }}</p>
      <div class="errorActions">
        <button (click)="retryLoad()" class="retryButton">
          üîÑ Retry Connection
        </button>
        <button (click)="fetchError = ''" class="dismissButton">
          ‚úï Dismiss
        </button>
      </div>
    </div>
  </section>

  <!-- Task List Section -->
  <section *ngIf="!isLoading && !fetchError" class="section">
    <header class="taskListHeader">
      <h2 class="taskListTitle">Your todos</h2>
      <nav aria-label="Task filter options">
        <div class="filterContainer" role="tablist">
          <button
            (click)="setFilter('all')"
            [ngClass]="{
              filterBtnActive: currentFilter === 'all'
            }"
            class="filterBtn filterBtnAll"
            role="tab"
            [attr.aria-selected]="currentFilter === 'all'"
            aria-label="Show all tasks"
          >
            All
          </button>
          <button
            (click)="setFilter('pending')"
            [ngClass]="{
              filterBtnActive: currentFilter === 'pending'
            }"
            class="filterBtn filterBtnPending"
            role="tab"
            [attr.aria-selected]="currentFilter === 'pending'"
            aria-label="Show pending tasks"
          >
            Pending
          </button>
          <button
            (click)="setFilter('completed')"
            [ngClass]="{
              filterBtnActive: currentFilter === 'completed'
            }"
            class="filterBtn filterBtnCompleted"
            role="tab"
            [attr.aria-selected]="currentFilter === 'completed'"
            aria-label="Show completed tasks"
          >
            Completed
          </button>
        </div>
      </nav>
    </header>

    <div class="taskList" role="list" aria-label="Task list">
      <article
        *ngFor="let todo of filteredTodos; trackBy: trackByTodoId"
        class="taskItem"
        [class.taskItemCompleted]="todo.completed"
        role="listitem"
        (click)="toggleCompletion(todo.id)"
      >
        <input
          type="checkbox"
          [id]="'task-' + todo.id"
          [checked]="todo.completed"
          (click)="$event.stopPropagation()"
          class="taskCheckbox"
          [attr.aria-label]="
            'Mark task as ' + (todo.completed ? 'incomplete' : 'complete')
          "
        />

        <label
          [for]="'task-' + todo.id"
          class="taskTitle"
          [class.taskTitleLineThrough]="todo.completed"
        >
          {{ todo.title }}
        </label>

        <button
          (click)="deleteTask(todo.id); $event.stopPropagation()"
          class="deleteBtn"
          [attr.aria-label]="'Delete task: ' + todo.title"
        >
          <span aria-hidden="true">√ó</span>
        </button>
      </article>
    </div>

    <p
      *ngIf="filteredTodos.length === 0 && !isLoading && !fetchError"
      class="emptyState"
      role="status"
    >
      {{
        currentFilter === "all"
          ? "No todos yet"
          : "No " + currentFilter + " todos"
      }}
      ü§∑‚Äç‚ôÇÔ∏è
    </p>
  </section>

  <div class="smallScreenMessage">
    <div class="messageContent">
      <h1>üì± Screen Too Small</h1>
      <p>We do not support screens smaller than 300px width.</p>
      <p>Please use a larger device or resize your browser window.</p>
    </div>
  </div>
</main>
