<main class="container">
  <header class="header">
    <h1 class="title">Todo tracker ðŸ“‹&nbsp;âœ…</h1>
  </header>

  <!-- Add Task Section -->
  <section class="section">
    <form
      (ngSubmit)="addTask()"
      class="form"
      role="form"
      aria-label="Add new task"
    >
      <label for="new-task-input" class="sr-only">Task title</label>
      <input
        id="new-task-input"
        type="text"
        [(ngModel)]="newTodoTitle"
        name="newTodoTitle"
        placeholder="What needs to be done?"
        class="input"
        aria-describedby="add-task-button"
      />
      <button
        id="add-task-button"
        type="submit"
        class="addButton"
        aria-label="Add new task"
      >
        Add todo
      </button>
    </form>
  </section>

  <!-- Task List Section -->
  <section class="section">
    <header class="taskListHeader">
      <h2 class="taskListTitle">Your todos</h2>
      <nav aria-label="Task filter options">
        <div class="filterContainer" role="tablist">
          <button
            (click)="setFilter('all')"
            [ngClass]="{
              filterBtnActive: currentFilter === 'all'
            }"
            class="filterBtn filterBtnAll"
            role="tab"
            [attr.aria-selected]="currentFilter === 'all'"
            aria-label="Show all tasks"
          >
            All
          </button>
          <button
            (click)="setFilter('pending')"
            [ngClass]="{
              filterBtnActive: currentFilter === 'pending'
            }"
            class="filterBtn filterBtnPending"
            role="tab"
            [attr.aria-selected]="currentFilter === 'pending'"
            aria-label="Show pending tasks"
          >
            Pending
          </button>
          <button
            (click)="setFilter('completed')"
            [ngClass]="{
              filterBtnActive: currentFilter === 'completed'
            }"
            class="filterBtn filterBtnCompleted"
            role="tab"
            [attr.aria-selected]="currentFilter === 'completed'"
            aria-label="Show completed tasks"
          >
            Completed
          </button>
        </div>
      </nav>
    </header>

    <div
      cdkDropList
      [cdkDropListData]="allTodos"
      (cdkDropListDropped)="drop($event)"
      class="taskList"
      role="list"
      aria-label="Task list"
    >
      <article
        *ngFor="let todo of filteredTodos; trackBy: trackByTodoId"
        cdkDrag
        [cdkDragData]="todo"
        class="taskItem"
        [class.taskItemCompleted]="todo.completed"
        role="listitem"
      >
        <button
          class="dragHandle"
          cdkDragHandle
          aria-label="Drag to reorder task"
        >
          <span aria-hidden="true">â ¿</span>
        </button>

        <input
          type="checkbox"
          [id]="'task-' + todo.id"
          [checked]="todo.completed"
          (change)="toggleCompletion(todo.id)"
          class="taskCheckbox"
          [attr.aria-label]="
            'Mark task as ' + (todo.completed ? 'incomplete' : 'complete')
          "
        />

        <label
          [for]="'task-' + todo.id"
          class="taskTitle"
          [class.taskTitleLineThrough]="todo.completed"
        >
          {{ todo.title }}
        </label>

        <button
          (click)="deleteTask(todo.id)"
          class="deleteBtn"
          [attr.aria-label]="'Delete task: ' + todo.title"
        >
          <span aria-hidden="true">Ã—</span>
        </button>
      </article>
    </div>

    <p *ngIf="filteredTodos.length === 0" class="emptyState">
      No tasks here. Add one to get started!
    </p>
  </section>

  <!-- Status section -->
  <section class="section">
    <div class="statusGrid">
      <div class="statusCardsContainer">
        <article class="statusCard statusCardAll">
          <p class="statusCardLabel">All</p>
          <span class="statusCardValue" aria-label="Total tasks">{{
            totalTasks
          }}</span>
        </article>
        <article class="statusCard statusCardPending">
          <p class="statusCardLabel">Pending</p>
          <span class="statusCardValue" aria-label="Pending tasks">{{
            pendingTasks
          }}</span>
        </article>
        <article class="statusCard statusCardCompleted">
          <p class="statusCardLabel">Completed</p>
          <span class="statusCardValue" aria-label="Completed tasks">{{
            completedTasks
          }}</span>
        </article>
      </div>
      <div class="chartContainer">
        <canvas #completionChart aria-label="Task completion chart"></canvas>
      </div>
    </div>
  </section>
</main>

<div class="smallScreenMessage">
  <div class="messageContent">
    <h1>ðŸ“± Screen Too Small</h1>
    <p>We do not support screens smaller than 300px width.</p>
    <p>Please use a larger device or resize your browser window.</p>
  </div>
</div>
