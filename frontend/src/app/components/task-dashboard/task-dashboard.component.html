<main class="container mx-auto max-w-4xl p-4 sm:p-6 md:p-8">
  <header class="text-center mb-8">
    <h1 class="text-4xl font-bold text-slate-900">Task Dashboard</h1>
    <p class="text-slate-500 mt-2">
      Your interactive command center for productivity.
    </p>
  </header>

  <section class="mb-8 p-6 bg-white rounded-xl shadow-sm">
    <h2 class="text-2xl font-semibold mb-4 text-slate-800">Current Status</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-center">
      <div class="md:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-4">
        <article class="status-card status-card--all">
          <p class="text-sm font-medium text-slate-500">All</p>
          <span
            class="text-3xl font-bold text-slate-900"
            aria-label="Total tasks"
            >{{ totalTasks }}</span
          >
        </article>
        <article class="status-card status-card--pending">
          <p class="text-sm font-medium">Pending</p>
          <span class="text-3xl font-bold" aria-label="Pending tasks">{{
            pendingTasks
          }}</span>
        </article>
        <article class="status-card status-card--completed">
          <p class="text-sm font-medium">Completed</p>
          <span class="text-3xl font-bold" aria-label="Completed tasks">{{
            completedTasks
          }}</span>
        </article>
      </div>
      <div class="chart-container">
        <canvas #completionChart aria-label="Task completion chart"></canvas>
      </div>
    </div>
  </section>

  <!-- Add Task Section -->
  <section class="mb-8">
    <form
      (ngSubmit)="addTask()"
      class="flex flex-col sm:flex-row gap-3 bg-white p-4 rounded-xl shadow-sm"
      role="form"
      aria-label="Add new task"
    >
      <label for="new-task-input" class="sr-only">Task title</label>
      <input
        id="new-task-input"
        type="text"
        [(ngModel)]="newTodoTitle"
        name="newTodoTitle"
        placeholder="What needs to be done?"
        class="flex-grow p-3 border border-slate-200 rounded-lg focus:outline-[#8e3c10] focus:outline-none transition"
        aria-describedby="add-task-button"
      />
      <button
        id="add-task-button"
        type="submit"
        class="bg-[#db570b] text-white font-semibold px-6 py-3 rounded-[1rem] hover:bg-[#8e3c10] transition duration-200"
        aria-label="Add new task"
      >
        Add
      </button>
    </form>
  </section>

  <!-- Task List Section -->
  <section class="bg-white p-4 sm:p-6 rounded-xl shadow-sm">
    <header class="flex flex-col sm:flex-row justify-between items-center mb-4">
      <h2 class="text-2xl font-semibold text-slate-800 mb-2 sm:mb-0">
        Your Tasks
      </h2>
      <nav aria-label="Task filter options">
        <div class="flex items-center gap-2" role="tablist">
          <button
            (click)="setFilter('all')"
            [ngClass]="{
              'filter-btn--active': currentFilter === 'all'
            }"
            class="filter-btn filter-btn--all"
            role="tab"
            [attr.aria-selected]="currentFilter === 'all'"
            aria-label="Show all tasks"
          >
            All
          </button>
          <button
            (click)="setFilter('pending')"
            [ngClass]="{
              'filter-btn--active': currentFilter === 'pending'
            }"
            class="filter-btn filter-btn--pending"
            role="tab"
            [attr.aria-selected]="currentFilter === 'pending'"
            aria-label="Show pending tasks"
          >
            Pending
          </button>
          <button
            (click)="setFilter('completed')"
            [ngClass]="{
              'filter-btn--active': currentFilter === 'completed'
            }"
            class="filter-btn filter-btn--completed"
            role="tab"
            [attr.aria-selected]="currentFilter === 'completed'"
            aria-label="Show completed tasks"
          >
            Completed
          </button>
        </div>
      </nav>
    </header>

    <div
      cdkDropList
      [cdkDropListData]="allTodos"
      (cdkDropListDropped)="drop($event)"
      class="space-y-3"
      role="list"
      aria-label="Task list"
    >
      <article
        *ngFor="let todo of filteredTodos; trackBy: trackByTodoId"
        cdkDrag
        [cdkDragData]="todo"
        class="task-item"
        [class.completed-task]="todo.completed"
        role="listitem"
      >
        <button
          class="drag-handle"
          cdkDragHandle
          aria-label="Drag to reorder task"
        >
          <span aria-hidden="true">⠿</span>
        </button>

        <input
          type="checkbox"
          [id]="'task-' + todo.id"
          [checked]="todo.completed"
          (change)="toggleCompletion(todo.id)"
          class="task-checkbox"
          [attr.aria-label]="
            'Mark task as ' + (todo.completed ? 'incomplete' : 'complete')
          "
        />

        <label
          [for]="'task-' + todo.id"
          class="task-title"
          [class.line-through]="todo.completed"
        >
          {{ todo.title }}
        </label>

        <button
          (click)="deleteTask(todo.id)"
          class="delete-btn"
          [attr.aria-label]="'Delete task: ' + todo.title"
        >
          <span aria-hidden="true">×</span>
        </button>
      </article>
    </div>

    <p
      *ngIf="filteredTodos.length === 0"
      class="text-center py-12 text-slate-500"
    >
      No tasks here. Add one to get started!
    </p>
  </section>
</main>
